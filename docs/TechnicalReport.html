<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Technical Report – website</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-1fe81d0376b2c50856e68e651e390326.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Documentation.html"> 
<span class="menu-text">Documentation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Tutorial.html"> 
<span class="menu-text">Tutorial</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./TechnicalReport.html" aria-current="page"> 
<span class="menu-text">Technical Report</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary">Executive Summary</a></li>
  <li><a href="#project-context" id="toc-project-context" class="nav-link" data-scroll-target="#project-context">Project Context</a></li>
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources">Data Sources</a></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology">Methodology</a></li>
  <li><a href="#results-diagnostics" id="toc-results-diagnostics" class="nav-link" data-scroll-target="#results-diagnostics">Results &amp; Diagnostics</a>
  <ul class="collapse">
  <li><a href="#comparing-regions-northern-vs-southern-states" id="toc-comparing-regions-northern-vs-southern-states" class="nav-link" data-scroll-target="#comparing-regions-northern-vs-southern-states">Comparing Regions: Northern vs Southern States</a></li>
  <li><a href="#comparing-regions-east-vs-west-states" id="toc-comparing-regions-east-vs-west-states" class="nav-link" data-scroll-target="#comparing-regions-east-vs-west-states">Comparing Regions: East vs West States</a></li>
  </ul></li>
  <li><a href="#best-ols-model-for-average-pm-2.5" id="toc-best-ols-model-for-average-pm-2.5" class="nav-link" data-scroll-target="#best-ols-model-for-average-pm-2.5">Best OLS Model for Average PM 2.5</a>
  <ul class="collapse">
  <li><a href="#model-fit-statistics" id="toc-model-fit-statistics" class="nav-link" data-scroll-target="#model-fit-statistics">Model Fit Statistics</a></li>
  <li><a href="#regression-coefficients" id="toc-regression-coefficients" class="nav-link" data-scroll-target="#regression-coefficients">Regression Coefficients</a></li>
  <li><a href="#model-diagnostics" id="toc-model-diagnostics" class="nav-link" data-scroll-target="#model-diagnostics">Model Diagnostics</a></li>
  </ul></li>
  <li><a href="#discussion-next-steps" id="toc-discussion-next-steps" class="nav-link" data-scroll-target="#discussion-next-steps">Discussion &amp; Next Steps</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Technical Report</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="executive-summary" class="level2">
<h2 class="anchored" data-anchor-id="executive-summary">Executive Summary</h2>
<p>This project examines the relationship between air quality and various socio-economic and demographic indicators across U.S. states. These indicators include the percentage of adults aged 25 and older who did not complete high school, the Human Development Index assigned to each state, the number of people experiencing homelessness per 10,000 residents, the percentage of the homeless population that is unsheltered, and the Health, Education, and Income indices for each state.</p>
<p>We chose to measure air quality in terms of PM2.5, which refers to fine particulate matter with a diameter of 2.5 micrometers or less from sources like vehicles, factories, and wood burning. Values were averaged from a random sample of 20 air-quality sensors in each state.</p>
</section>
<section id="project-context" class="level2">
<h2 class="anchored" data-anchor-id="project-context">Project Context</h2>
<p>Air pollution is a critical public health concern, with PM2.5 being particularly harmful due to its ability to penetrate deep into the lungs and bloodstream. Understanding how and if air quality correlates with socio-economic factors such as education, income, and homelessness can help stakeholders such as public health agencies and policymakers prioritize resources and interventions.</p>
<p>Success criteria for our project include creating a Python package that successfully cleans data from our sources and produces a final dataset that can be analyzed both visually and through descriptive statistics.</p>
</section>
<section id="data-sources" class="level2">
<h2 class="anchored" data-anchor-id="data-sources">Data Sources</h2>
<ul>
<li><strong>Primary dataset:</strong> <a href="https://openaq.org/">OpenAQ</a> – Global air quality measurements, focusing on PM2.5 concentrations across U.S. states. Data was accessed via API.</li>
<li><strong>Supplementary data:</strong> <a href="https://measureofamerica.org/maps/">Measure of America</a> – Socio-economic indicators at the state level, including Human Development Index (HDI), Health Index, Education Index, Income Index, and homelessness statistics. Provided as Excel files.</li>
</ul>
</section>
<section id="methodology" class="level2">
<h2 class="anchored" data-anchor-id="methodology">Methodology</h2>
<ol type="1">
<li><strong>Data Acquisition</strong></li>
</ol>
<p>We collected PM2.5 data from OpenAQ using their API. Obtaining individual sensor data required multiple API requests. First, we queried the API to retrieve a list of U.S. locations. Using these locations, we then sent additional requests to obtain sensor-level measurements, filtering to include only sensors that recorded PM2.5 values. After removing missing (NaN) values, we grouped the data by state and selected a random sample of 20 PM2.5 sensors per state. For each sampled sensor, we calculated the most recent yearly average and used these values to estimate a state-level PM2.5 average.</p>
<p>The Measure of America datasets were freely downloadable in Excel format; however, we were required to provide contact information, describe our intended use of the data, and consent to using the data for non-commercial purposes only.</p>
<ol start="2" type="1">
<li><strong>Cleaning pipeline</strong></li>
</ol>
<p>Data cleaning steps included handling missing values, standardizing column names, and converting data types. Measure of America did not provide a single consolidated Excel file; instead, separate files were used to report different indicators (e.g., education, environmental information, and the Human Development Index). To assemble the required variables, we combined multiple Excel files, resolved multi-level headers, and selected only the relevant fields.</p>
<p>Similarly, the OpenAQ data required merging multiple data frames obtained from separate API requests. These were consolidated into a final data frame containing one row per U.S. state and an estimated state-level PM2.5 value, which was then joined with the socio-economic data.</p>
<p>The main tools that we used throughout this cleaning process were the python libraries <code>pandas</code> and <code>requests</code>.</p>
</section>
<section id="results-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="results-diagnostics">Results &amp; Diagnostics</h2>
<p>Using our package, we performed several analyses on our data. The analyses and their results are outlined in the following sections.</p>
<section id="comparing-regions-northern-vs-southern-states" class="level3">
<h3 class="anchored" data-anchor-id="comparing-regions-northern-vs-southern-states">Comparing Regions: Northern vs Southern States</h3>
<p>We used a t-test to compare Northern and Southern states. The only variable showing a statistically significant regional difference is Health_Index. Other variables (air pollution, education, income, homelessness) do not differ significantly between North and Southern states.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Variable</th>
<th>t-statistic</th>
<th>p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Avg_PM25</td>
<td>-0.6254</td>
<td>0.5377</td>
</tr>
<tr class="even">
<td>Health_Index</td>
<td>4.6735</td>
<td>0.0001</td>
</tr>
<tr class="odd">
<td>Education_Index</td>
<td>1.6863</td>
<td>0.1055</td>
</tr>
<tr class="even">
<td>Income_Index</td>
<td>0.8212</td>
<td>0.4191</td>
</tr>
<tr class="odd">
<td>Homeless_Ratio</td>
<td>-0.0878</td>
<td>0.9310</td>
</tr>
</tbody>
</table>
</section>
<section id="comparing-regions-east-vs-west-states" class="level3">
<h3 class="anchored" data-anchor-id="comparing-regions-east-vs-west-states">Comparing Regions: East vs West States</h3>
<p>Looking at Eastern vs Western states, there is a significant difference in both education and health indices, but none of the other socioeconomic measures.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Variable</th>
<th>t-statistic</th>
<th>p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Avg_PM25</td>
<td>0.0927</td>
<td>0.9268</td>
</tr>
<tr class="even">
<td>Health_Index</td>
<td>-2.3041</td>
<td>0.0257</td>
</tr>
<tr class="odd">
<td>Education_Index</td>
<td>2.2673</td>
<td>0.0279</td>
</tr>
<tr class="even">
<td>Income_Index</td>
<td>1.4959</td>
<td>0.1413</td>
</tr>
<tr class="odd">
<td>Homeless_Ratio</td>
<td>-0.7737</td>
<td>0.4428</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="best-ols-model-for-average-pm-2.5" class="level2">
<h2 class="anchored" data-anchor-id="best-ols-model-for-average-pm-2.5">Best OLS Model for Average PM 2.5</h2>
<p><strong>Predictors:</strong> Not Graduated, HDI, Homeless Ratio</p>
<p>The best Ordinary Least Squares (OLS) model for predicting average PM2.5 levels looked at three state-level factors: the percentage of people age 25 and over who did not graduate from high school, the Human Development Index (HDI), and the homelessness ratio. The model explains only a small part of the differences in PM2.5 between states. Of the three factors, not graduating and homelessness were significant predictors: states with more people who did not graduate tended to have higher PM2.5, while states with higher homelessness had slightly lower PM2.5. HDI showed a small positive effect, but it was not strong enough to be considered statistically significant. The model also suggests that the predictors themselves might be closely related (multicollinearity), which can make the specific size of the effects a little less certain. Some tests suggest that the data is a bit uneven (the errors are not normally distributed), so the results should be interpreted with caution.</p>
<section id="model-fit-statistics" class="level3">
<h3 class="anchored" data-anchor-id="model-fit-statistics">Model Fit Statistics</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Metric</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Number of observations</td>
<td>51</td>
</tr>
<tr class="even">
<td>R-squared</td>
<td>0.135</td>
</tr>
<tr class="odd">
<td>Adjusted R-squared</td>
<td>0.080</td>
</tr>
<tr class="even">
<td>F-statistic</td>
<td>2.446</td>
</tr>
<tr class="odd">
<td>Prob (F-statistic)</td>
<td>0.0755</td>
</tr>
<tr class="even">
<td>Log-Likelihood</td>
<td>-138.30</td>
</tr>
<tr class="odd">
<td>AIC</td>
<td>284.6</td>
</tr>
<tr class="even">
<td>BIC</td>
<td>292.3</td>
</tr>
<tr class="odd">
<td>Durbin–Watson</td>
<td>1.922</td>
</tr>
</tbody>
</table>
</section>
<section id="regression-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="regression-coefficients">Regression Coefficients</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 15%">
<col style="width: 14%">
<col style="width: 15%">
<col style="width: 12%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Coefficient</th>
<th>Std. Error</th>
<th>t-statistic</th>
<th>p-value</th>
<th>95% CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Intercept</td>
<td>-4.7427</td>
<td>6.893</td>
<td>-0.688</td>
<td>0.495</td>
<td>[-18.609, 9.124]</td>
</tr>
<tr class="even">
<td>Not_graduated</td>
<td>0.4467</td>
<td>0.216</td>
<td>2.065</td>
<td><strong>0.044</strong></td>
<td>[0.012, 0.882]</td>
</tr>
<tr class="odd">
<td>HDI</td>
<td>2.0516</td>
<td>1.115</td>
<td>1.840</td>
<td>0.072</td>
<td>[-0.191, 4.295]</td>
</tr>
<tr class="even">
<td>Homeless_Ratio</td>
<td>-0.0818</td>
<td>0.039</td>
<td>-2.086</td>
<td><strong>0.042</strong></td>
<td>[-0.161, -0.003]</td>
</tr>
</tbody>
</table>
</section>
<section id="model-diagnostics" class="level3">
<h3 class="anchored" data-anchor-id="model-diagnostics">Model Diagnostics</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Statistic</th>
<th>p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Omnibus</td>
<td>37.476</td>
<td>0.000</td>
</tr>
<tr class="even">
<td>Jarque–Bera</td>
<td>108.202</td>
<td>3.19e-24</td>
</tr>
<tr class="odd">
<td>Skewness</td>
<td>2.040</td>
<td>—</td>
</tr>
<tr class="even">
<td>Kurtosis</td>
<td>8.855</td>
<td>—</td>
</tr>
<tr class="odd">
<td>Condition Number</td>
<td>337</td>
<td>—</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="discussion-next-steps" class="level2">
<h2 class="anchored" data-anchor-id="discussion-next-steps">Discussion &amp; Next Steps</h2>
<p>Our analysis aimed to identify key state-level factors associated with average PM2.5 levels across the U.S. using an Ordinary Least Squares (OLS) regression model. The overall model only explained a small portion (13.5%) of the differences in PM2.5 between states, indicating that most of the variation is driven by other factors not included in this analysis, such as local industry, geography, or specific air quality regulations.</p>
<p>The choropleth map on our <a href="https://usadata-ud9jga4moajasfjsnuocvw.streamlit.app/">Streamlit app</a> shows the geographical spread of PM2.5 values, highlighting state-to-state variation. Notably, the map shows that Virginia has a high PM2.5 value, which appears to be an outlier that could be influencing the regression results.</p>
<p>The <strong>correlation matrix</strong> reveals some interesting relationships. Unfortunately, the average PM2.5 value for each state only has a weak positive correlation with the percentage of adults who did not graduate high school, and an almost nonexistent correlation with the other variables, including the Health, Education, and Income indices.</p>
<p>As expected, the Human Development Index (HDI) is highly correlated with its constituent parts—Health, Education, and Income indices. There are, however, to suprising observations. First, there is a moderate positive correlation (+0.53) between the Homeless Ratio and the HDI, which seems counter-intuitive and may be worth further investigation. The correlation matrix also shows a weak linear relationship between the percentage of electricity generated by coal and natural gas and the average PM2.5 levels, which we expected would have a relationship.</p>
<section id="limitations" class="level4">
<h4 class="anchored" data-anchor-id="limitations">Limitations</h4>
<ul>
<li><p><strong>Multicollinearity</strong>: The OLS model and the correlation matrix indicated that there was multicollinearity—several predictor variables are highly correlated with each other. This makes it difficult to isolate the unique effect of any single predictor.</p></li>
<li><p><strong>Outlier Influence</strong>: The presence of a likely outlier (one of Virginia’s sensors) may be distorting the fit of the model and the coefficient values.</p></li>
</ul>
</section>
<section id="future-experiments-and-open-questions" class="level4">
<h4 class="anchored" data-anchor-id="future-experiments-and-open-questions">Future Experiments and Open Questions</h4>
<p>To build a more robust predictive model, future analysis should consider the following steps:</p>
<ul>
<li><strong>Address Outliers</strong>: Run the model again after removing the outlier sensor in Virginia to see if anything changes.</li>
<li><strong>Explore Different Predictors</strong>: Given the model’s low R², additional variables should be investigated, such as state-level air quality regulations, population density, or local industry composition (e.g., manufacturing vs.&nbsp;service).</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>